<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>VORTEKS â€” Unicode Card Battler</title>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles/main.css">
</head>
<body>
  <div class="wrap">
    <!-- Top-right buttons: telemetry, unlocks, glossary, defeated, mute, and help -->
    <button id="telemetryBtn" aria-label="Telemetry" title="View your gameplay stats and analytics">ğŸ“Š</button>
    <button id="unlocksBtn" aria-label="Unlocks" title="View unlocked cards and achievements">ğŸ†</button>
    <button id="glossaryBtn" aria-label="Glossary" title="View card glossary">ğŸ“–</button>
    <button id="defeatedBtn" aria-label="Defeated Opponents" title="View defeated opponents history">ğŸ´</button>
    <button id="muteBtn" aria-label="Mute music" title="Mute/unmute music">ğŸ”Š</button>
    <button id="helpBtn" aria-label="Help" title="How to play VORTEKS">?</button>
    <h1>VORTEKS</h1>
    <!-- Opponent Panel -->
    <div class="panel" id="oppPanel">
      <div class="opp-box">
        <div>
          <canvas id="oppFace" width="96" height="96" aria-label="Opponent face"></canvas>
          <div id="oppName">NAME</div>
        </div>
        <div>
          <div class="hud">
            <div class="pill">OPP â¤<span id="oppHP"></span></div>
            <div class="pill sh">ğŸ›¡<span id="oppSH"></span></div>
            <div class="pill en">âš¡<span id="oppEN"></span></div>
          </div>
          <div class="status" id="oppStatus"></div>
          <div class="controls">
            <button id="rerollFace" class="btn">REROLL FACE</button>
          </div>
        </div>
      </div>
    </div>
    <!-- Player Panel -->
    <div class="panel" id="youPanel">
      <div class="hud">
        <div class="pill">YOU â¤<span id="youHP"></span></div>
        <div class="pill sh">ğŸ›¡<span id="youSH"></span></div>
        <div class="pill en">âš¡<span id="youEN"></span></div>
        <div class="pill" id="streakPill" title="Win streak">STREAK <span id="streak"></span></div>
      </div>
      <div class="status" id="youStatus"></div>
      <div class="hand" id="hand"></div>
      <div class="controls">
        <button id="endTurn" class="btn">END TURN</button>
        <button id="restart" class="btn">RESTART</button>
      </div>
    </div>
    <!-- Log Panel -->
    <div class="panel">
      <div class="log" id="log" aria-live="polite"></div>
    </div>
  </div>
  <!-- Start Screen Modal -->
  <div class="modal" id="startModal">
    <div class="start-container">
      <div class="dim-overlay" aria-hidden="true"></div>
      <div class="fog-layer" aria-hidden="true"></div>
      <img id="titleImg" src="vortexicon.png" data-fallback="title.png" alt="VORTEKS" class="title-image" />
      <div id="titleText" class="title-fallback">VORTEKS</div>
      <div id="motto" class="motto"></div>
      <div class="content-overlay">
        <div class="button-group">
          <button id="startBtn" class="btn" title="Choose your cards and quirk">BUILD DECK</button>
          <button id="quickBtn" class="btn" title="Jump straight into battle with a random deck">QUICK START</button>
        </div>
        <div class="debug-group">
          <button id="selfTest" class="btn debug-btn" title="Run built-in tests">DEBUG</button>
        </div>
      </div>
    </div>
  </div>
  <!-- Deck Builder Modal -->
  <div class="modal" id="deckModal" hidden>
    <div class="box">
      <div><strong>Build Your Deck</strong> â€” pick <span id="deckNeed">20</span> cards (max 4 of any one). Choose a mix of card types for unlock achievements!</div>
      <div class="qgrid" id="deckGrid"></div>
      <div style="display:flex;align-items:center;gap:8px;margin-top:8px;justify-content:space-between">
        <div>Selected: <span id="deckCount">0</span>/20</div>
        <div>
          <button id="deckCancel" class="btn">CANCEL</button>
          <button id="deckQuick" class="btn" title="Fill a random valid deck">QUICK PLAY</button>
          <button id="deckClear" class="btn">CLEAR</button>
          <button id="deckConfirm" class="btn" disabled>CONFIRM</button>
        </div>
      </div>
    </div>
  </div>
  <!-- Quirk Picker Modal -->
  <div class="modal" id="quirkModal" hidden>
    <div class="box">
      <div><strong>Pick a Quirk</strong> â€” oneâ€‘line identity for this run.</div>
      <div class="qgrid" id="quirkGrid"></div>
    </div>
  </div>
  <!-- How to Play Modal -->
  <div class="modal" id="helpModal" hidden>
    <div class="box" style="width:min(96vw, 720px); max-height:90vh;">
      <div style="font-size:18px; color:var(--accent); margin:8px 0 16px; text-align:center"><strong>How to Play VORTEKS</strong></div>
      
      <!-- Tab Navigation -->
      <div class="help-tabs" style="display:flex; margin-bottom:16px; border-bottom:2px solid var(--border)">
        <button class="help-tab active" data-tab="basics">Basics</button>
        <button class="help-tab" data-tab="cards">Cards</button>
        <button class="help-tab" data-tab="effects">Effects</button>
        <button class="help-tab" data-tab="quirks">Quirks</button>
        <button class="help-tab" data-tab="symbols">Symbols</button>
      </div>
      
      <!-- Tab Content -->
      <div class="help-content" style="max-height:400px; overflow-y:auto; text-align:left; line-height:1.4;">
        
        <!-- Basics Tab -->
        <div class="help-panel" data-panel="basics">
          <h3 style="color:var(--accent); margin-top:0">Welcome to VORTEKS!</h3>
          <p>A tactical card battler where every decision matters. Your goal is to defeat AI opponents by reducing their health to 0 while keeping yourself alive.</p>
          
          <h4 style="color:var(--accent)">Core Gameplay</h4>
          <div style="margin-left:16px">
            <p><strong>âš¡ Energy:</strong> Start with 3 energy each turn. Use it to play cards.</p>
            <p><strong>â¤ Health:</strong> Lose the game if it reaches 0. Can heal above maximum (overheal).</p>
            <p><strong>ğŸ›¡ Shields:</strong> Block incoming damage. No upper limit.</p>
            <p><strong>ğŸƒ Hand:</strong> Draw 1 card each turn. Play cards to attack, defend, or gain advantages.</p>
          </div>
          
          <h4 style="color:var(--accent)">Turn Flow</h4>
          <div style="margin-left:16px">
            <p>1. Draw a card (if deck not empty)</p>
            <p>2. Your turn: play cards, use energy</p>
            <p>3. Opponent's turn: they play their cards</p>
            <p>4. End of turn: status effects trigger, energy resets</p>
          </div>
          
          <h4 style="color:var(--accent)">Building Decks</h4>
          <p>Choose 20 cards for your deck. Maximum 4 copies of any single card. Balance attacks, defenses, and special effects for optimal strategy.</p>
        </div>
        
        <!-- Cards Tab -->
        <div class="help-panel" data-panel="cards" style="display:none">
          <h3 style="color:var(--accent); margin-top:0">Card Types & Examples</h3>
          
          <h4 style="color:var(--accent)">âš” Attack Cards</h4>
          <div style="margin-left:16px">
            <p><strong>âš” Strike (1âš¡):</strong> Deal 3 damage. Gains +1 damage if you have bonus energy next turn.</p>
            <p><strong>ğŸ—¡ Pierce (2âš¡):</strong> Deal 3 damage. Always does at least 1 damage through shields.</p>
            <p><strong>ğŸ”¥ Ignite (2âš¡):</strong> Burn opponent for 2 damage over 2 turns.</p>
          </div>
          
          <h4 style="color:var(--accent)">ğŸ›¡ Defense Cards</h4>
          <div style="margin-left:16px">
            <p><strong>ğŸ›¡ Guard (1âš¡):</strong> Gain 3 shields to block incoming damage.</p>
            <p><strong>â™¥ Heart (1âš¡):</strong> Heal 3 health. Can heal above maximum.</p>
          </div>
          
          <h4 style="color:var(--accent)">âœ¨ Skill Cards</h4>
          <div style="margin-left:16px">
            <p><strong>âœ¨ Focus (1âš¡):</strong> +2 energy for your next turn only.</p>
            <p><strong>â„ Freeze (2âš¡):</strong> Freeze 1 of opponent's energy next turn.</p>
            <p><strong>ğŸ” Echo (1âš¡):</strong> Special effect varies by situation.</p>
          </div>
          
          <h4 style="color:var(--accent)">ğŸ”„ Advanced Cards</h4>
          <div style="margin-left:16px">
            <p><strong>âŸ³ Surge (2âš¡):</strong> +1 max energy, +1 energy now.</p>
            <p><strong>ğŸ”€ Reconsider (ALLâš¡):</strong> Spend all energy to reshuffle your deck and draw cards.</p>
          </div>
        </div>
        
        <!-- Effects Tab -->
        <div class="help-panel" data-panel="effects" style="display:none">
          <h3 style="color:var(--accent); margin-top:0">Status Effects</h3>
          
          <h4 style="color:var(--accent)">ğŸ”¥ Burn</h4>
          <div style="margin-left:16px">
            <p>Takes damage at the end of each turn. Stacks with itself (amount and duration).</p>
            <p><strong>Example:</strong> Burn 2 for 3 turns = 2 damage per turn for 3 turns</p>
          </div>
          
          <h4 style="color:var(--accent)">â„ Freeze</h4>
          <div style="margin-left:16px">
            <p>Reduces available energy for the affected turns.</p>
            <p><strong>Example:</strong> Freeze 1 energy = opponent has 1 less energy next turn</p>
          </div>
          
          <h4 style="color:var(--accent)">ğŸ›¡ Shield</h4>
          <div style="margin-left:16px">
            <p>Blocks incoming damage point-for-point. No upper limit.</p>
            <p><strong>Pierce:</strong> Some attacks bypass 1 shield and deal at least 1 damage</p>
          </div>
          
          <h4 style="color:var(--accent)">âš¡ Energy Modifiers</h4>
          <div style="margin-left:16px">
            <p><strong>+Energy Next Turn:</strong> Temporary bonus energy for one turn</p>
            <p><strong>Max Energy:</strong> Permanent increase to energy per turn</p>
            <p><strong>Cleanse:</strong> Removes negative status effects</p>
          </div>
          
          <h4 style="color:var(--accent)">ğŸ’« Overheal</h4>
          <div style="margin-left:16px">
            <p>Healing above maximum health is allowed up to 150% of max HP.</p>
            <p>Provides a buffer against incoming damage.</p>
          </div>
        </div>
        
        <!-- Quirks Tab -->
        <div class="help-panel" data-panel="quirks" style="display:none">
          <h3 style="color:var(--accent); margin-top:0">Quirks & Progression</h3>
          
          <h4 style="color:var(--accent)">What are Quirks?</h4>
          <p>Special modifiers that define your playstyle for each run. Choose one quirk before each battle to gain unique advantages.</p>
          
          <h4 style="color:var(--accent)">Starting Quirks</h4>
          <div style="margin-left:16px">
            <p><strong>MY FIRST QUIRK:</strong> Start with +1 card in your opening hand</p>
          </div>
          
          <h4 style="color:var(--accent)">Unlockable Quirks</h4>
          <div style="margin-left:16px">
            <p><strong>MINTY:</strong> Start with +1 max energy (and +1 current energy)</p>
            <p style="font-size:0.9em; opacity:0.8">Unlock: Spend 7+ energy in a single turn</p>
            
            <p><strong>SPICY:</strong> Your burn effects deal +1 extra damage</p>
            <p style="font-size:0.9em; opacity:0.8">Unlock: Deal 10+ burn damage in one battle</p>
            
            <p><strong>HEARTY:</strong> Heal +5 HP at the start of each battle</p>
            <p style="font-size:0.9em; opacity:0.8">Unlock: Win with 95%+ of max health remaining</p>
            
            <p><strong>GUARDIAN:</strong> Gain +1 shield at the start of each turn</p>
            <p style="font-size:0.9em; opacity:0.8">Unlock: Accumulate 10+ shield then win</p>
          </div>
          
          <h4 style="color:var(--accent)">Card Unlocks</h4>
          <p>Defeat different opponent personas to unlock new cards:</p>
          <div style="margin-left:16px">
            <p><strong>Cat/Feline personas:</strong> Unlock Curiosity card</p>
            <p><strong>Robot/Automaton personas:</strong> Unlock Droid Protocol card</p>
          </div>
        </div>
        
        <!-- Symbols Tab -->
        <div class="help-panel" data-panel="symbols" style="display:none">
          <h3 style="color:var(--accent); margin-top:0">Game Symbols & UI</h3>
          
          <h4 style="color:var(--accent)">Interface Elements</h4>
          <div style="margin-left:16px">
            <p><strong>YOU/OPP:</strong> Player and opponent health/shield/energy displays</p>
            <p><strong>STREAK:</strong> Current win streak counter</p>
            <p><strong>END TURN:</strong> Complete your turn and pass to opponent</p>
            <p><strong>RESTART:</strong> Start over with a new opponent</p>
            <p><strong>REROLL FACE:</strong> Generate a new opponent appearance</p>
            <p><strong>ğŸ†:</strong> View unlocked cards and achievements</p>
            <p><strong>ğŸ“–:</strong> Open card glossary (shows all card effects)</p>
            <p><strong>ğŸ´:</strong> View defeated opponents history</p>
            <p><strong>ğŸ”Š:</strong> Mute/unmute background music</p>
            <p><strong>?:</strong> Open this help modal</p>
          </div>
          
          <h4 style="color:var(--accent)">Status Display</h4>
          <div style="margin-left:16px">
            <p><strong>ğŸ”¥ 2 (3):</strong> Burn 2 damage for 3 turns</p>
            <p><strong>â„ 1:</strong> Frozen energy (1 less next turn)</p>
            <p><strong>+2:</strong> Bonus energy next turn</p>
            <p><strong>1/3:</strong> Current turn / Max energy</p>
          </div>
          
          <h4 style="color:var(--accent)">Card Costs</h4>
          <div style="margin-left:16px">
            <p><strong>Numbers (1, 2, 3):</strong> Fixed energy cost</p>
            <p><strong>ALL:</strong> Spend all current energy</p>
            <p><strong>Affordable indicators:</strong> Cards glow when playable</p>
          </div>
          
          <h4 style="color:var(--accent)">Tooltips & Predictions</h4>
          <p>Hover over cards to see detailed effects and predicted outcomes. The game shows you exactly what will happen before you play a card.</p>
        </div>
        
      </div>
      
      <!-- Footer -->
      <div style="display:flex; justify-content:center; margin-top:16px; padding-top:12px; border-top:1px solid var(--border)">
        <button id="helpCloseBtn" class="btn" style="background:var(--good); color:black; font-weight:bold">Got it!</button>
      </div>
    </div>
  </div>
  <!-- Victory Modal -->
  <div class="modal" id="victoryModal" hidden>
    <div class="box" style="text-align:center; width:min(96vw, 480px)">
      <div style="font-size:20px; color:var(--good); margin:8px 0 16px"><strong>Victory!</strong></div>
      <div style="margin-bottom:16px">You defeated your opponent and your streak continues!</div>
      <div style="display:flex; flex-direction:column; gap:8px;">
        <button id="nextBattleBtn" class="btn" style="background:var(--good); color:black; font-weight:bold">NEXT BATTLE</button>
        <div style="display:flex; gap:8px; justify-content:center">
          <button id="victoryUnlocksBtn" class="btn">UNLOCKS</button>
          <button id="victoryDeckBtn" class="btn">DECK BUILDER</button>
          <button id="victoryRestartBtn" class="btn">RESTART</button>
        </div>
      </div>
    </div>
  </div>
  <!-- Unlocks Modal -->
  <div class="modal" id="unlocksModal" hidden>
    <div class="box" style="width:min(96vw, 600px)">
      <div id="unlocksTitle" style="font-size:18px; color:var(--accent); margin:8px 0 16px; text-align:center"><strong>Unlocks</strong></div>
      <div style="margin-bottom:16px">
        <div style="font-size:14px; color:var(--accent); margin-bottom:8px"><strong>Cards</strong></div>
        <div id="unlocksCardsGrid" class="qgrid" style="max-height:200px; overflow-y:auto;"></div>
      </div>
      <div style="margin-bottom:16px">
        <div style="font-size:14px; color:var(--accent); margin-bottom:8px"><strong>Quirks</strong></div>
        <div id="unlocksQuirksGrid" class="qgrid" style="max-height:200px; overflow-y:auto;"></div>
      </div>
      <div style="display:flex; justify-content:center; margin-top:16px; gap:8px">
        <button id="unlocksCloseBtn" class="btn">CLOSE</button>
        <button id="unlocksClearBtn" class="btn" style="background:var(--bad); color:white">CLEAR UNLOCKS</button>
      </div>
    </div>
  </div>
  <!-- Glossary Modal -->
  <div class="modal" id="glossaryModal" hidden>
    <div class="box" style="width:min(96vw, 600px)">
      <div style="font-size:18px; color:var(--accent); margin:8px 0 16px; text-align:center"><strong>Card Glossary</strong></div>
      <div id="glossaryGrid" class="qgrid" style="max-height:400px; overflow-y:auto;"></div>
      <div style="display:flex; justify-content:center; margin-top:16px">
        <button id="glossaryCloseBtn" class="btn">CLOSE</button>
      </div>
    </div>
  </div>
  <!-- Defeated Opponents Modal -->
  <div class="modal" id="defeatedModal" hidden>
    <div class="box" style="width:min(96vw, 500px)">
      <div style="font-size:18px; color:var(--accent); margin:8px 0 16px; text-align:center"><strong>Defeated Opponents</strong></div>
      <div id="defeatedList" style="max-height:300px; overflow-y:auto; margin-bottom:16px;">
        <div style="text-align:center; color:var(--ink); opacity:0.7; padding:20px;">No opponents defeated yet.</div>
      </div>
      <div style="display:flex; justify-content:center; gap:8px">
        <button id="defeatedCloseBtn" class="btn">CLOSE</button>
        <button id="defeatedClearBtn" class="btn" style="background:var(--bad); color:white">CLEAR HISTORY</button>
      </div>
    </div>
  </div>
  <!-- Telemetry Modal -->
  <div class="modal" id="telemetryModal" hidden>
    <div class="box" style="width:min(96vw, 700px); max-height:80vh; overflow-y:auto">
      <div style="font-size:18px; color:var(--accent); margin:8px 0 16px; text-align:center"><strong>ğŸ“Š Player Analytics</strong></div>
      
      <!-- Battle Statistics -->
      <div style="margin-bottom:16px">
        <div style="font-size:14px; color:var(--accent); margin-bottom:8px"><strong>Battle Statistics</strong></div>
        <div id="telemetryBattleStats" style="background:rgba(0,0,0,0.3); padding:12px; border-radius:4px; line-height:1.6">
          <div>Loading battle statistics...</div>
        </div>
      </div>
      
      <!-- Favorite Cards -->
      <div style="margin-bottom:16px">
        <div style="font-size:14px; color:var(--accent); margin-bottom:8px"><strong>Card Usage Analysis</strong></div>
        <div id="telemetryCardStats" style="background:rgba(0,0,0,0.3); padding:12px; border-radius:4px; line-height:1.6">
          <div>Loading card usage data...</div>
        </div>
      </div>
      
      <!-- Gameplay Patterns -->
      <div style="margin-bottom:16px">
        <div style="font-size:14px; color:var(--accent); margin-bottom:8px"><strong>Gameplay Patterns</strong></div>
        <div id="telemetryPatterns" style="background:rgba(0,0,0,0.3); padding:12px; border-radius:4px; line-height:1.6">
          <div>Loading gameplay patterns...</div>
        </div>
      </div>
      
      <!-- Achievement Progress -->
      <div style="margin-bottom:16px">
        <div style="font-size:14px; color:var(--accent); margin-bottom:8px"><strong>Achievement Progress</strong></div>
        <div id="telemetryAchievements" style="background:rgba(0,0,0,0.3); padding:12px; border-radius:4px; line-height:1.6">
          <div>Loading achievement data...</div>
        </div>
      </div>
      
      <div style="display:flex; justify-content:center; gap:8px; margin-top:16px">
        <button id="telemetryCloseBtn" class="btn">CLOSE</button>
        <button id="telemetryResetBtn" class="btn" style="background:var(--bad); color:white">RESET STATS</button>
      </div>
    </div>
  </div>
  <script type="module" src="src/main.js"></script>
</body>
</html>
